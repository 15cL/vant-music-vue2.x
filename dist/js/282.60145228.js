"use strict";(self["webpackChunkvue_littlefivemusic"]=self["webpackChunkvue_littlefivemusic"]||[]).push([[282],{9282:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"search_page"},[t("header",[t("span",{staticClass:"iconfont icon-xiangzuo",staticStyle:{"font-size":"1.1rem",width:"10%"},on:{click:function(t){return e.backBtn(e.searchInput)}}}),t("van-field",{ref:"input_van",staticStyle:{"border-radius":"3rem",width:"70%"},attrs:{"left-icon":"search",placeholder:"你好",autofocus:""},on:{input:function(t){return e.checkKeyword(e.searchInput)},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchSong(e.searchInput)}},model:{value:e.searchInput,callback:function(t){e.searchInput=t},expression:"searchInput"}}),t("p",{on:{click:function(t){return e.searchSong(e.searchInput)}}},[e._v("搜索")])],1),t("section",{ref:"wrapper"},[t("div",{staticClass:"content"},[t("div",[e.searchInput||e.searchFlag?t("div",{staticClass:"my_search"},[e.searchInput?e._e():t("div",{staticClass:"search_org"},[e.key_history[0]?t("div",{staticClass:"search_history"},[t("header",[t("h3",[e._v("历史")]),t("van-icon",{attrs:{name:"delete",size:"20"},on:{click:e.deleteAll}})],1),t("ul",e._l(e.key_history,(function(s,a){return t("li",{key:a,on:{click:function(t){return e.searchSong(s)}}},[e._v(" "+e._s(s)+" ")])})),0)]):e._e(),t("div",{staticClass:"search_history"},[e._m(0),t("ul",e._l(e.ideas,(function(s,a){return t("li",{key:a,on:{click:function(t){return e.searchSong(s.first)}}},[e._v(" "+e._s(s.first)+" ")])})),0)]),t("div",{staticClass:"search_hot"},[t("h2",[e._v("热搜榜")]),t("ul",e._l(e.searchHot,(function(s,a){return t("li",{key:s.score,on:{click:function(t){return e.searchSong(s.searchWord)}}},[t("span",{style:{color:a==e.hotIndex[a]?"gold":""}},[e._v(e._s(a+1))]),t("p",[e._v(e._s(s.searchWord))]),t("van-icon",{attrs:{name:s.iconUrl}})],1)})),0)])]),e.searchFlag?e._e():t("div",{staticClass:"search_res"},[e.searchSongRes.searchQcReminder?t("div",{staticClass:"tip"},e._l(e.searchSongRes.searchQcReminder.qcReminders,(function(s,a){return t("span",{key:a,style:{color:s.highLight?"rgb(110, 110, 171)":"",textDecoration:s.highLight?"underline":""}},[e._v(e._s(s.qcReminderPart))])})),0):e._e(),t("h2",[e._v("单曲")]),t("van-list",{staticClass:"ul_song",attrs:{finished:e.finished,"finished-text":"没有更多了"},on:{load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},e._l(e.searchSongRes.songs,(function(s,a){return t("li",{key:s.id,staticClass:"li_song",on:{click:function(t){return e.toPlay(s.id,s,a)}}},[e.tapFlag!==a?t("span",[e._v(e._s(a+1))]):t("span",{staticClass:"iconfont icon-bar-chart-fill",staticStyle:{color:"orange","font-size":"1.3rem"}}),t("div",{staticClass:"zj_text"},[t("h3",{class:e.tapFlag==a?"active":""},[e._v(" "+e._s(s.name)+" ")]),t("div",{staticClass:"gray csl"},[t("span",[e._v(e._s(s.ar))]),e._v(" - "+e._s(s.al.name)+" ")])]),t("span",{staticClass:"iconfont icon-yuandiancaidan"})])})),0)],1)]):e._e(),e.searchInput&&e.searchFlag?t("div",{staticClass:"search_tip"},[t("ul",e._l(e.searchTips,(function(s){return t("li",{key:s.id,on:{click:function(t){return e.searchSong(s.name)}}},[t("van-icon",{attrs:{name:"search"}}),e._v(" "),t("span",[e._v(" "+e._s(s.name))])],1)})),0)]):e._e()])])])])},r=[function(){var e=this,t=e._self._c;return t("header",[t("h3",[e._v("推荐")])])}],i=(s(7658),s(3822)),n=s(472),c={data(){return{searchInput:"",searchTips:[],searchHot:"",hotIndex:[0,1,2],searchSongRes:[],loading:!1,finished:!1,searchFlag:!0,offset:0,tapFlag:null,key_history:"",ideas:"",wrapper:null}},computed:{...(0,i.Se)(["currentPlaySong","keys_history"])},watch:{keys_history(e){this.key_history=e},wrapper(){console.log("hhh"),this.wrapper.refresh()}},async activated(){this.$refs.input_van.focus();let e=await this.$store.dispatch("search/getSearchHot");this.searchHot=e.data.data;let t=await this.$store.dispatch("search/getSearchIdea"),s=[];t.data.result.hots.map(((e,t)=>{t<3&&s.push(e)})),this.ideas=s,this.$nextTick((()=>{this._initScroll()}))},mounted(){window.addEventListener("load",(()=>{window.localStorage.getItem("keywords")&&(this.key_history=JSON.parse(window.localStorage.getItem("keywords"))||[])}))},methods:{...(0,i.nv)(["search/getSearchTip","search/getSearchRes","play/getPlayUrl","play/getSongDetail"]),...(0,i.OI)(["play/setCurrentPlaySong","play/setCurrentPlayList","search/setSearchHistory","search/clearSearchHistory"]),_initScroll(){this.wrapper||(this.wrapper=window.BScroll(this.$refs.wrapper,{click:!0,scrollY:!0,observeDOM:!0}),console.log(this.wrapper))},backBtn(e){e?(this.searchInput="",this.searchFlag=!0):this.$router.go(-1)},async checkKeyword(e){if(!e)return void(this.searchFlag=!0);let t=[],s=await this["search/getSearchTip"](e);Object.values(s.data.result).map((e=>{e.map((e=>{e.length||t.push(e)}))})),this.searchTips=t},async searchSong(e){this.offset=0,this.searchInput=e,this.searchFlag=!1;let t=[];window.localStorage.getItem("keywords")&&(t=JSON.parse(window.localStorage.getItem("keywords"))),t.push(e),this["search/setSearchHistory"](t);let s={keywords:e,type:1,offset:this.offset},a=await this["search/getSearchRes"](s);a.data.result.songs.map((e=>{e.ar=(0,n.v)(e.ar)})),this.searchSongRes=a.data.result,this.tapFlag=this.searchSongRes.songs.findIndex((e=>e.id==this.currentPlaySong.id))},async onLoad(){this.offset=this.offset+1;let e={keywords:this.searchInput,type:1,offset:this.offset},t=await this["search/getSearchRes"](e);t.data.result.songs.map((e=>{e.ar=(0,n.v)(e.ar),this.searchSongRes.songs.push(e)})),this["play/setCurrentPlayList"](this.searchSongRes.songs),this.loading=!1},async toPlay(e,t,s){let a=await this["play/getPlayUrl"](e);if(!a)return this.$toast("当前音乐无可用资源"),this.toPlay(this.allSong[s+1].id,this.allSong[s+1],s+1);this.tapFlag=s,t.index=s,this.$store.commit("play/switchPlayer"),this["play/setCurrentPlaySong"](t),this["play/getSongDetail"](e)},deleteAll(){let e=this;this.$dialog.confirm({message:"确定清空全部历史记录?",beforeClose:function(t,s){"confirm"===t?(setTimeout(e["search/clearSearchHistory"],500),s()):s()}})}}},o=c,l=s(1001),h=(0,l.Z)(o,a,r,!1,null,"e559e01e",null),u=h.exports}}]);
//# sourceMappingURL=282.60145228.js.map